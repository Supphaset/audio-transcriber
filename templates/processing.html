{% extends "base.html" %}

{% block title %}Processing - Audio Transcriber{% endblock %}

{% block content %}
<div class="progress-container">
    <h2 style="color: #333; text-align: center; margin-bottom: 20px;">
        <span class="emoji loading">‚öôÔ∏è</span> Processing Your Audio Files
    </h2>
    
    <div class="file-info">
        <p><strong>Files to process:</strong> {{ file_count }}</p>
        <p><strong>Mode:</strong> 
            {% if test_mode %}
                <span style="color: #ff9800;">üß™ Test Mode (1 minute per file)</span>
            {% else %}
                <span style="color: #4CAF50;">üìÑ Full Transcription</span>
            {% endif %}
        </p>
        <p><strong>Status:</strong> <span id="status">Initializing...</span></p>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
        <div style="width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #4CAF50; border-radius: 50%; animation: spin 2s linear infinite; margin: 0 auto;"></div>
        <p style="margin-top: 15px; color: #666;">This may take a few minutes depending on file size...</p>
    </div>
    
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 20px 0;">
        <h4 style="color: #856404; margin-bottom: 10px;">
            <span class="emoji">‚è±Ô∏è</span> Estimated Processing Time
        </h4>
        <ul style="color: #856404; margin-left: 20px;">
            <li>Test mode: ~1-2 minutes per file</li>
            <li>Full transcription: ~2-5 minutes per hour of audio</li>
            <li>Large files are automatically chunked for processing</li>
        </ul>
    </div>
</div>

<!-- Auto-start processing -->
<script>
// Build the URL with parameters
const params = new URLSearchParams({
    {% for key, value in processing_data.items() %}
        {% if key == 'files' %}
            {% for file in value %}
                'files': '{{ file }}',
            {% endfor %}
        {% else %}
            '{{ key }}': '{{ value }}',
        {% endif %}
    {% endfor %}
});

// Update status
document.getElementById('status').textContent = 'Starting transcription...';

// Redirect to processing endpoint
setTimeout(function() {
    window.location.href = '/process/{{ session_id }}?' + params.toString();
}, 2000);

// Optional: Add periodic status updates
let dots = 0;
setInterval(function() {
    dots = (dots + 1) % 4;
    const statusEl = document.getElementById('status');
    if (statusEl.textContent.includes('Starting')) {
        statusEl.textContent = 'Starting transcription' + '.'.repeat(dots);
    }
}, 500);
</script>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}